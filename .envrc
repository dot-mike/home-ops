#shellcheck disable=SC2148,SC2155,SC2046
export ANSIBLE_CONFIG=$(expand_path ./infrastructure/ansible/ansible.cfg)
export ANSIBLE_VAULT_PASSWORD_FILE=$(expand_path .vault-pass)

export $(ansible-vault decrypt --output - .env | xargs)
export $(ansible-vault decrypt --output - .env | xargs -I% echo % | tr '[:upper:]' '[:lower:]' | xargs -I% echo TF_VAR_%)

#https://opentofu.org/docs/cli/config/environment-variables/#tf_encryption
export TF_ENCRYPTION=$(cat <<EOF
key_provider "pbkdf2" "my_passphrase" { passphrase = "${TF_STATE_ENCRYPTION_PASSPHRASE}"}
EOF
)
